esphome:
  name: mintymcu_panel
  platform: ESP8266
  board: d1_mini_lite

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  power_save_mode: none
  fast_connect: True
  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: !secret ap_ssid
    password: !secret ap_password

captive_portal:

# Enable logging
logger:
  level: VERBOSE

# Enable Home Assistant API
api:
  password: !secret api_password

mqtt:
  broker: !secret mqtt_broker
  username: !secret mqtt_username
  password: !secret mqtt_password

ota:
  password: !secret ota_password

i2c:
  sda: D1
  scl: D2

switch:
  # System
  - platform: restart
    name: "MintyMCU_Control_Panel Restart"
  - platform: gpio
    pin: D3
    id: switch_panel_led
  - platform: template
    name: "MintyMCU_Control_Panel LED"
    turn_on_action:
      - switch.turn_on: switch_panel_led
      - delay: 500ms
      - switch.turn_off: switch_panel_led

font:
  - file: "OpenSans-Regular.ttf"
    id: font_opensans_16
    size: 16

display:
  - platform: ssd1306_i2c
    model: "SSD1306 128x32"
    # reset_pin: D0
    address: 0x3C
    lambda: |-
      it.printf(0, 0, id(font_opensans_16), "From HASS: %s", id(text_panel_display).state.c_str());

sensor:
  - platform: wifi_signal
    name: "MintyMCU_Control_Panel WiFi Signal Sensor"
    update_interval: 60s
  - platform: uptime
    name: "MintyMCU_Control_Panel Uptime Sensor"
    update_interval: 60s
    filters:
      - lambda: return x / (24 * 3600);
    unit_of_measurement: "days"
  - platform: rotary_encoder
    name: "MintyMCU_Control_Panel Rotary Encoder"
    pin_a: D5
    pin_b: D6
    resolution: 1
    min_value: -100
    max_value: 100
  - platform: adc
    pin: A0
    name: "MintyMCU_Control_Panel Pin Buttons"
    update_interval: 0.5s
    unit_of_measurement: code
    id: panel_adc_sensor
    filters:
      - lambda: |-
          return ( x * (1023 / 3.3));
      - lambda: |-
          if (x > 100) {
            return x;
          } else {
            return 0.0;
          }
      # - filter_out: 0.0
      # - filter_out: 585.93758
      # - filter_out: 488.28125

binary_sensor:
    - platform: status
      name: "MintyMCU_Control_Panel Status"
    - platform: template
      name: "MintyMCU_Control_Panel Volume Mute Trigger Sensor"
      id: sensor_trigger_speakers_mute
    - platform: template
      name: "MintyMCU_Control_Panel Power Trigger Sensor"
      id: sensor_trigger_speakers_power
    - platform: template
      name: "MintyMCU_Control_Panel Upper Button K0"
      id: sensor_panel_button_upper_k0
      lambda: |-
        if (id(panel_adc_sensor).state >= 144.0 && id(panel_adc_sensor).state <= 148.0) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Upper Button K1"
      id: sensor_panel_button_upper_k1
      lambda: |-
        if (id(panel_adc_sensor).state >= 149.0 && id(panel_adc_sensor).state <= 150.5) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Upper Button K2"
      id: sensor_panel_button_upper_k2
      lambda: |-
        if (id(panel_adc_sensor).state >= 150.6 && id(panel_adc_sensor).state <= 152.0) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Upper Button K3"
      id: sensor_panel_button_upper_k3
      lambda: |-
        if (id(panel_adc_sensor).state >= 158.0 && id(panel_adc_sensor).state <= 161.0) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Upper Button K4"
      id: sensor_panel_button_upper_k4
      lambda: |-
        if (id(panel_adc_sensor).state >= 162.0 && id(panel_adc_sensor).state <= 163.9) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Upper Button K5"
      id: sensor_panel_button_upper_k5
      lambda: |-
        if (id(panel_adc_sensor).state >= 164.0 && id(panel_adc_sensor).state <= 164.9) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Upper Button K6"
      id: sensor_panel_button_upper_k6
      lambda: |-
        if (id(panel_adc_sensor).state >= 165.0 && id(panel_adc_sensor).state <= 166.5) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Upper Button K7"
      id: sensor_panel_button_upper_k7
      lambda: |-
        if (id(panel_adc_sensor).state >= 167.0 && id(panel_adc_sensor).state <= 168.0) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Lower Button K0"
      id: sensor_panel_button_lower_k0
      lambda: |-
        if (id(panel_adc_sensor).state >= 189.0 && id(panel_adc_sensor).state <= 192.0) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Lower Button K1"
      id: sensor_panel_button_lower_k1
      lambda: |-
        if (id(panel_adc_sensor).state >= 197.0 && id(panel_adc_sensor).state <= 199.5) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Lower Button K2"
      id: sensor_panel_button_lower_k2
      lambda: |-
        if (id(panel_adc_sensor).state >= 199.6 && id(panel_adc_sensor).state <= 205.0) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Lower Button K3"
      id: sensor_panel_button_lower_k3
      lambda: |-
        if (id(panel_adc_sensor).state >= 216.0 && id(panel_adc_sensor).state <= 220.0) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Lower Button K4"
      id: sensor_panel_button_lower_k4
      lambda: |-
        if (id(panel_adc_sensor).state >= 223.0 && id(panel_adc_sensor).state <= 224.9) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Lower Button K5"
      id: sensor_panel_button_lower_k5
      lambda: |-
        if (id(panel_adc_sensor).state >= 225.0 && id(panel_adc_sensor).state <= 226.5) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Lower Button K6"
      id: sensor_panel_button_lower_k6
      lambda: |-
        if (id(panel_adc_sensor).state >= 227.0 && id(panel_adc_sensor).state <= 229.9) {
          return true;
        } else {
          return false;
        }
    - platform: template
      name: "MintyMCU_Control_Panel Lower Button K7"
      id: sensor_panel_button_lower_k7
      lambda: |-
        if (id(panel_adc_sensor).state >= 230.0 && id(panel_adc_sensor).state <= 231) {
          return true;
        } else {
          return false;
        }
text_sensor:
  - platform: wifi_info
    ip_address:
      name: "MintyMCU_Control_Panel IP Address"
    ssid:
      name: "MintyMCU_Control_Panel Connected SSID"
    bssid:
      name: "MintyMCU_Control_Panel Connected BSSID"
  - platform: version
    name: "MintyMCU_Control_Panel ESPHome Version"
  - platform: mqtt_subscribe
    name: "MintyMCU_Control_Panel Display Info"
    id: text_panel_display
    topic: mintymcu/control_panel_display

# secret: !include secrets.yaml
